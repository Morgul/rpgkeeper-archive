<tabset class="detail-tabs">
    <tab heading="Attributes" select="setTab('attributes')" ng-if="showAttributes">
        <div ng-include="'/systems/dnd4e/partials/attributes.html'"></div>
    </tab>
    <tab heading="Powers" select="setTab('powers')">
        <div class="powers">
            <div class="power" ng-repeat="powerRef in sysChar.powers | orderBy: [sortPowerType, sortPowerKind, sortPowerLevel, 'power.name']" ng-init="collapse['power-' + $index] = true">
                <h4 class="title {{ powerRef.power.type.toLowerCase() }}" ng-click="collapse['power-' + $index] = !collapse['power-' + $index]">
                    <span  ng-repeat="i in range(powerRef.maxUses) track by $index">
                        <i title="Indicates if a power has been used." ng-if="powerRef.power.type != 'At-Will'" class="{{ getUseIcon(powerRef, $index) }}" ng-click="handleUse(powerRef, $index, $event)"></i>
                    </span>
                    <button type="button" title="Remove this power" class="close" aria-hidden="true" ng-click="removePower(powerRef, $event)">&times;</button>
                    <button type="button" title="Edit this power" class="close edit" aria-hidden="true" ng-click="editPowerRef(powerRef, $event)"><i class="icon-edit"></i></button>
                    <span class="type-level" ng-switch="powerRef.power.kind">{{ powerRef.power.kind }}<span ng-if="powerRef.power.level"> {{ powerRef.power.level }}</span></span>
                    <b>{{ powerRef.power.name }}</b>
                </h4>
                <div collapse="collapse['power-' + $index]">
                    <div class="flavor" ng-if="powerRef.power.flavor">{{ powerRef.power.flavor }}
                    </div>
                    <div class="section details">
                        <div>
                            <b>{{ powerRef.power.type }}</b>
                            <span ng-if="powerRef.power.keywords">&diams; <b>{{ powerRef.power.keywords.join(', ') }}</b></span>
                        </div>
                        <div>
                            <span style="display: inline-block; width: 49.5%;"><b>{{ powerRef.power.actionType }}</b></span>
                            <span style="display: inline-block; width: 49.5%;"><b>{{ powerRef.power.range }}</b></span>
                        </div>
                    </div>
                    <div class="sections">
                        <div class="section" ng-repeat="section in powerRef.power.sections">
                            <b>{{ section.title }}:</b> <span ng-bind-html="section.content | markdown"></span>
                        </div>
                        <div class="section notes" ng-if="powerRef.notes">
                            <b>Notes:</b> <span ng-bind-html="powerRef.notes | markdown"></span>
                        </div>
                    </div>
                    <div  ng-if="powerRef.rolls" class="rolls">
                        <div class="row">
                            <div ng-class="getPowerRollSize($index, $last)" ng-repeat="roll in powerRef.rolls">
                                <roll-button class="btn-block" roll-title="'[' + powerRef.power.name + '] ' + roll.title" roll="roll" context="sysChar"></roll-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </tab>
    <tab heading="Feats" select="setTab('feats')">
        <div class="feats">
            <div class="feat" ng-repeat="featRef in sysChar.feats | orderBy: 'feat.name'" ng-init="collapse['feat-' + $index] = true">
                <h4 class="title" ng-click="collapse['feat-' + $index] = !collapse['feat-' + $index]">
                    <button type="button" title="Remove this feat" class="close" aria-hidden="true" ng-click="removeFeat(featRef, $event)">&times;</button>
                    <button type="button" title="Edit this feat" class="close edit" aria-hidden="true" ng-click="editFeatRef(featRef, $event)"><i class="icon-edit"></i></button>
                    {{ featRef.feat.name }}
                </h4>
                <div collapse="collapse['feat-' + $index]">
                    <div class="section prerequisites" ng-if="featRef.feat.prerequisites">
                        <b>Prerequisites:</b> <span ng-bind-html="featRef.feat.prerequisites | markdown"></span>
                    </div>
                    <div class="section description" ng-if="featRef.feat.description">
                        <b>Description:</b> <span ng-bind-html="featRef.feat.description | markdown"></span>
                    </div>
                    <div class="section special" ng-if="featRef.feat.special">
                        <b>Special:</b> <span ng-bind-html="featRef.feat.special | markdown"></span>
                    </div>
                    <div class="section notes" ng-if="featRef.notes">
                        <b>Notes:</b> <span ng-bind-html="featRef.notes | markdown"></span>
                    </div>
                </div>
            </div>
        </div>
    </tab>
    <tab heading="Equipment" select="setTab('equipment')">
        <h4 class="text-center">Not Implemented Yet</h4>
    </tab>
    <tab title="Rolls" select="setTab('rolls')">
        <tab-heading>
            <i class='icon-dice'></i>
        </tab-heading>
        <div class="rolls-tab">
            <div class="form-group">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Generic rolls here..." ng-model="genericRoll" ng-enter="doGenericRoll()">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button" ng-click="doGenericRoll()">Roll</button>
                    <button class="btn btn-default" type="button" ng-click="clearRolls()">Clear</button>
                </span>
                </div>
            </div>
            <div class="form-group">
                <div class="form-control fake">
                    <p ng-repeat="roll in pastRolls track by $index">{{ roll || "&nbsp;" }}</p>
                </div>
            </div>
            <hr>
            <div class="form-group" ng-repeat="roll in sysChar.rolls">
                <div ng-hide="rollEdits[$index]" class="btn-group btn-block">
                    <roll-button class="fill-width" roll="roll" context="sysChar"></roll-button>
                    <button type="button" class="btn btn-default" ng-click="editRoll($index)"><i class="icon-edit"></i></button>
                    <button type="button" class="btn btn-default" ng-click="removeRoll(roll)"><i class="icon-remove"></i></button>
                </div>
                <div ng-show="rollEdits[$index] && rollEdits[$index] != 'roll'" class="input-group">
                    <span class="input-group-addon">Title:</span>
                    <input type="text" class="form-control" placeholder="Roll title..." ng-model="roll.title" ng-enter="startUpdateRoll($index)">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button" ng-click="startUpdateRoll($index)">Next</button>
                    </span>
                </div>
                <div ng-show="rollEdits[$index] == 'roll'" class="input-group">
                    <span class="input-group-addon">Roll:</span>
                    <input type="text" class="form-control" placeholder="Roll title..." ng-model="roll.roll" ng-enter="updateRoll(roll)">
                    <span class="input-group-btn">
                        <button class="btn btn-primary" type="button" ng-click="updateRoll(roll, $index)">Save Roll</button>
                    </span>
                </div>
            </div>
            <h5 ng-if="sysChar.rolls.length == 0" class="text-center">No general rolls added yet.</h5>
            <hr>
            <div class="form-group">
                <div ng-hide="addStage == 'roll'" class="input-group">
                    <span class="input-group-addon">Title:</span>
                    <input type="text" class="form-control" placeholder="ex: Sneak Attack" ng-model="newRoll.title" ng-enter="startAddRoll()">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button" ng-click="startAddRoll()">Add Roll</button>
                    </span>
                </div>
                <div ng-show="addStage == 'roll'" class="input-group">
                    <span class="input-group-addon">Roll:</span>
                    <input id="rollTextEntry" type="text" class="form-control" placeholder="ex: 5d6 + [dexterityMod]" ng-model="newRoll.roll" ng-enter="addRoll()">
                    <span class="input-group-btn">
                        <button class="btn btn-primary" type="button" ng-click="addRoll()">Save Roll</button>
                    </span>
                </div>
            </div>
        </div>
    </tab>
    <tab title="Notes" select="setTab('notes')">
        <tab-heading>
            <i class='icon-edit'></i>
        </tab-heading>
        <textarea id="notes" class="form-control" ng-model="sysChar.notes" style="min-height: 600px;" msd-elastic ng-trim="false"></textarea>
    </tab>
</tabset>
